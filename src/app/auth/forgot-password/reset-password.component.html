<div class="min-h-screen flex items-center justify-center bg-[var(--color-bg)] text-[var(--color-text)] px-4">
  <div
    class="max-w-md w-full bg-[var(--color-bg)] border border-[var(--color-border)] p-6 md:p-8 rounded-2xl shadow-[0_0_10px_0_var(--color-shadow)]"
  >
    <div class="flex justify-center items-center mb-6">
      <img src="assets/logo-full.png" alt="EasyQuizzy" class="h-30 md:h-40 object-contain" />
    </div>

    <!-- Verificar código -->
    @if (step() === 'verify') {
      <h2 class="text-center mb-2">Verificar código</h2>
      <p class="subtitle text-center mb-6">
        Ingresa el código enviado a <strong>{{ email() }}</strong>
      </p>

      @if (errorMessage()) {
        <app-error [message]="errorMessage() | errorMessage"></app-error>
      }

      <form [formGroup]="verifyForm" (ngSubmit)="onVerifyCode()">
        <input
          formControlName="code"
          type="text"
          maxlength="6"
          placeholder="Código de verificación"
          class="input my-3 text-center font-semibold"
          [class.border-red-400]="v.code.touched && v.code.invalid"
        />

        <button type="submit" class="btn btn--primary w-full mt-4" [disabled]="loading()">
          @if (loading()) { Verificando... } @else { Verificar }
        </button>
      </form>
    }

    <!-- Cambiar contraseña -->
    @if (step() === 'reset') {
      <h2 class="text-center mb-2">Nueva contraseña</h2>
      <p class="subtitle text-center mb-6">Ingresa y confirma tu nueva contraseña</p>

      @if (errorMessage()) {
        <app-error [message]="errorMessage() | errorMessage"></app-error>
      }

      @if (successMessage()) {
        <p class="text-[var(--color-success)] text-center mb-4 font-medium">
          {{ successMessage() }}
        </p>
      }

      <form [formGroup]="resetForm" (ngSubmit)="onResetPassword()">
        <!-- Nueva contraseña -->
        <div>
          <input
            formControlName="password"
            type="password"
            placeholder="Nueva contraseña"
            class="input my-3"
            [class.border-red-400]="r.password.touched && r.password.invalid"
          />
          @if (r.password.touched && r.password.invalid) {
            <p class="error-text">Debe tener al menos 6 caracteres.</p>
          }
        </div>

        <!-- Confirmar contraseña -->
        <div>
          <input
            formControlName="confirm"
            type="password"
            placeholder="Confirmar contraseña"
            class="input my-3"
            [class.border-red-400]="r.confirm.touched && resetForm.hasError('mismatch')"
          />
          @if (resetForm.hasError('mismatch') && r.confirm.touched) {
            <p class="error-text">Las contraseñas no coinciden.</p>
          }
        </div>

        <button type="submit" class="btn btn--primary w-full mt-4" [disabled]="loading()">
          @if (loading()) { Cambiando... } @else { Cambiar contraseña }
        </button>
      </form>
    }

    <div class="text-center mt-6">
      <a routerLink="/auth/login" class="link">Volver al inicio de sesión</a>
    </div>
  </div>
</div>
