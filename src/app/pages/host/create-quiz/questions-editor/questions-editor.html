<div class="mb-8">
  <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2 mb-4">
    <h2 class="text-lg font-medium">Preguntas</h2>
    <div class="flex gap-2">
      <button
        type="button"
        (click)="generateExplanationsAll()"
        [disabled]="genAllLoading() || formArray.length === 0"
        class="border border-[var(--color-border)] px-3 py-2 rounded-lg hover:bg-[var(--color-bg-secondary)] transition text-sm"
      >
        {{ genAllLoading() ? 'Generandoâ€¦' : 'IA: Explicar todas' }}
      </button>

      <button
        type="button"
        (click)="addQuestion()"
        class="bg-[var(--color-primary)] text-white px-4 py-2 rounded-lg hover:opacity-90 transition"
      >
        + AÃ±adir pregunta
      </button>
    </div>
  </div>

  <!-- ðŸ”¥ LISTA CON DRAG & DROP -->
  <div cdkDropList (cdkDropListDropped)="drop($event)">
    @for (q of formArray.controls; track trackByIndex($index); let qIndex = $index) {
      <div cdkDrag class="relative mb-6 group">
        
        <!-- ðŸŽ¯ Handle visual de arrastre -->
        <div 
          cdkDragHandle
          class="absolute -left-10 top-4 w-8 h-8 rounded-lg border border-[var(--color-border)] bg-[var(--color-bg)] 
                 flex items-center justify-center cursor-grab active:cursor-grabbing
                 opacity-0 group-hover:opacity-100 transition-opacity shadow-sm hover:shadow-md"
          title="Arrastra para reordenar"
        >
          <mat-icon fontIcon="drag_indicator" class="text-[var(--color-muted)] text-base"></mat-icon>
        </div>

        <!-- Componente de pregunta existente -->
        <app-question-item
          [group]="getGroup(qIndex)"
          [index]="qIndex"
          [categoryNames]="categoryNames"
          (remove)="removeQuestion(qIndex)"
          (imageSelected)="onImageSelected(qIndex, $event)"
        ></app-question-item>
      </div>
    }
  </div>
</div>