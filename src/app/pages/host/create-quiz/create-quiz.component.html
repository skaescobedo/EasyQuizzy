<section class="max-w-5xl mx-auto bg-[var(--color-bg)] text-[var(--color-text)] p-6 rounded-2xl shadow-lg mt-6">
  <h1 class="text-2xl font-semibold mb-2">Crear un nuevo quiz</h1>
  <p class="text-[var(--color-muted)] mb-6">Completa los datos, categor√≠as y a√±ade tus preguntas para comenzar.</p>

  <!-- Toggle Manual / IA -->
  <div class="flex items-center gap-2 mb-6">
    <button type="button"
            (click)="setMode(false)"
            [class.bg-[var(--color-primary)]]="!useAI()"
            [class.text-white]="!useAI()"
            class="px-4 py-2 rounded-lg border border-[var(--color-border)] hover:opacity-90 transition">
      Manual
    </button>
    <button type="button"
            (click)="setMode(true)"
            [class.bg-[var(--color-primary)]]="useAI()"
            [class.text-white]="useAI()"
            class="px-4 py-2 rounded-lg border border-[var(--color-border)] hover:opacity-90 transition">
      IA (beta)
    </button>
  </div>

  <!-- Form Manual -->
  @if (!useAI()) {
    <form [formGroup]="quizForm" (ngSubmit)="submitQuiz()">
      <!-- üü¶ Informaci√≥n general -->
      <div class="mb-8">
        <h2 class="text-lg font-medium mb-3 border-b border-[var(--color-border)] pb-1">Informaci√≥n general</h2>

        <label class="block mb-2 font-medium">T√≠tulo del quiz</label>
        <input
          formControlName="title"
          placeholder="Ej: Conocimientos de Python"
          class="w-full border border-[var(--color-border)] bg-[var(--color-bg-secondary)] rounded-lg px-3 py-2 text-[var(--color-muted)] focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)]"
        />

        <label class="block mt-4 mb-2 font-medium">Descripci√≥n (opcional)</label>
        <textarea
          formControlName="description"
          rows="3"
          placeholder="Describe brevemente el prop√≥sito del quiz"
          class="w-full border border-[var(--color-border)] bg-[var(--color-bg-secondary)] rounded-lg px-3 py-2 text-[var(--color-muted)] focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)]"
        ></textarea>
      </div>

      <!-- üü© Categor√≠as -->
      <app-categories-editor
        [formArray]="categories"
        (removedCategory)="onCategoryRemoved($event)">
      </app-categories-editor>

      <!-- üüß Preguntas -->
      <app-questions-editor
        class="block mt-8"
        [formArray]="questions"
        [categoryNames]="categoryNames">
      </app-questions-editor>

      <!-- ‚öôÔ∏è Botones -->
      <div class="flex justify-between items-center pt-4 border-t border-[var(--color-border)] mt-8">
        <button
          type="button"
          routerLink="/host/quizzes"
          class="text-[var(--color-primary)] hover:underline font-medium"
        >
          Regresar
        </button>

        <button
          type="submit"
          [disabled]="loading()"
          class="bg-[var(--color-primary)] text-white px-6 py-2 rounded-lg hover:opacity-90 transition"
        >
          {{ loading() ? 'Guardando...' : 'Guardar Quiz' }}
        </button>
      </div>

      @if (error()) {
        <p class="text-[var(--color-danger)] mt-3">{{ error() }}</p>
      }
      @if (success()) {
        <p class="text-green-600 mt-3">‚úÖ Quiz creado correctamente</p>
      }
    </form>
  }

  <!-- Panel IA -->
  @if (useAI()) {
    <app-ai-builder (generated)="loadPreviewFromAI($event)"></app-ai-builder>
    <p class="text-sm text-[var(--color-muted)] mt-4">
      Al generar con IA, se cargar√° un borrador editable en el formulario manual.
    </p>
  }
</section>
